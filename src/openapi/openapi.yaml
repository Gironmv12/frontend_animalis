openapi: 3.0.3
info:
  title: Animalis API
  version: "0.1.0"
  description: API REST para gestión de mascotas, propietarios, historial y reportes. Espec inicial generada desde el frontend.
servers:
  - url: https://api.example.com
    description: Server de producción (reemplazar)
  - url: http://localhost:3000
    description: Desarrollo (coincide con VITE_API_URL)

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    LoginCredentials:
      type: object
      required: [correo, contrasena]
      properties:
        correo:
          type: string
          format: email
        contrasena:
          type: string
    LoginResponse:
      type: object
      properties:
        idUsuario:
          type: integer
        nombre:
          type: string
        apellidos:
          type: string
        correo:
          type: string
        rol:
          type: string
        estado:
          type: string
        fechaCreacion:
          type: string
          format: date-time
        token:
          type: string
    Mascota:
      type: object
      properties:
        idMascota:
          type: integer
        nombre:
          type: string
        especie:
          type: string
        raza:
          type: string
          nullable: true
        edad:
          type: integer
          nullable: true
        genero:
          type: string
          nullable: true
        fechaNacimiento:
          type: string
          format: date
          nullable: true
        propietarioId:
          type: integer
          nullable: true
        propietarioNombre:
          type: string
          nullable: true
        estado:
          type: string
          nullable: true
        color:
          type: string
          nullable: true
        microchip:
          type: string
          nullable: true
        peso:
          type: string
          nullable: true
        notas:
          type: string
          nullable: true
        foto:
          type: string
          nullable: true
    CreateMascotaPayload:
      type: object
      required: [nombre, especie, propietario]
      properties:
        nombre:
          type: string
        especie:
          type: string
        raza:
          type: string
          nullable: true
        edad:
          type: integer
          nullable: true
        genero:
          type: string
          nullable: true
        fechaNacimiento:
          type: string
          format: date
          nullable: true
        estado:
          type: string
          nullable: true
        color:
          type: string
          nullable: true
        microchip:
          type: string
          nullable: true
        peso:
          type: string
          nullable: true
        notas:
          type: string
          nullable: true
        foto:
          type: string
          nullable: true
        propietario:
          type: object
          properties:
            connect:
              type: object
              properties:
                idPropietario:
                  type: integer
    Propietario:
      type: object
      properties:
        id:
          type: integer
        nombre:
          type: string
        apellidos:
          type: string
        correo:
          type: string
        telefono:
          type: string
        direccion:
          type: string
        estado:
          type: string
        notas:
          type: string
        fechaUltimaVisita:
          type: string
          format: date
    PropietarioDetalle:
      type: object
      properties:
        propietario:
          $ref: '#/components/schemas/Propietario'
        mascotas:
          type: array
          items:
            $ref: '#/components/schemas/Mascota'

paths:
  /users/login:
    post:
      summary: Login de usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginCredentials'
      responses:
        '200':
          description: Login correcto
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Credenciales inválidas

  /mascotas:
    get:
      summary: Lista de mascotas
      parameters:
        - name: page
          in: query
          schema:
            type: integer
        - name: q
          in: query
          schema:
            type: string
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de mascotas
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Mascota'
    post:
      summary: Crear mascota
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateMascotaPayload'
          multipart/form-data:
            schema:
              type: object
              properties:
                foto:
                  type: string
                  format: binary
                payload:
                  type: string
                  description: JSON string con los datos (alternativa)
      responses:
        '201':
          description: Mascota creada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Mascota'

  /mascotas/{id}:
    get:
      summary: Obtener detalle de mascota
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Detalle mascota
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Mascota'
        '404':
          description: No encontrada
    put:
      summary: Actualizar mascota
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateMascotaPayload'
      responses:
        '200':
          description: Mascota actualizada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Mascota'
    delete:
      summary: Eliminar mascota
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Eliminada

  /mascotas/{id}/foto/view:
    get:
      summary: Obtener foto de la mascota (binary)
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Imagen
          content:
            image/*:
              schema:
                type: string
                format: binary
        '404':
          description: No encontrada

  /propietarios:
    get:
      summary: Lista de propietarios
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista propietarios
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Propietario'
    post:
      summary: Crear propietario
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Propietario'
      responses:
        '201':
          description: Creado

  /propietarios/{id}:
    get:
      summary: Obtener propietario
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Detalle del propietario
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Propietario'
    put:
      summary: Actualizar propietario
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Propietario'
      responses:
        '200':
          description: Actualizado
    delete:
      summary: Eliminar propietario
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Eliminado

  /propietarios/{id}/detalle:
    get:
      summary: Obtener detalle del propietario y sus mascotas
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Detalle del propietario y sus mascotas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PropietarioDetalle'

  /historialMedico:
    get:
      summary: Obtener historial médico (filtros)
      security:
        - bearerAuth: []
      parameters:
        - name: mascotaId
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Historial
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
    post:
      summary: Añadir evento al historial
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                mascotaId:
                  type: integer
                tipo:
                  type: string
                notas:
                  type: string
      responses:
        '201':
          description: Evento creado

  /reportes:
    get:
      summary: Generar/listar reportes
      security:
        - bearerAuth: []
      parameters:
        - name: tipo
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Reporte (JSON o CSV)
          content:
            application/json:
              schema:
                type: object

security:
  - bearerAuth: []